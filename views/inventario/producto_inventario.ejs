<%- include('../partials/header', { title }) %>

<div class="container my-4">
  <h2><%= producto.nombre %></h2>

  <!-- Datos básicos del producto -->
  <div class="row mb-4">
    <div class="col-md-4">
      <img src="/img/products/<%= producto.imagen || 'no-image.png' %>" alt="<%= producto.nombre %>" class="img-fluid rounded border">
    </div>
    <div class="col-md-8">
      <ul class="list-group">
        <li class="list-group-item"><strong>Marca:</strong> <%= producto.marca || '-' %></li>
        <li class="list-group-item"><strong>Material:</strong> <%= producto.material || '-' %></li>
        <li class="list-group-item"><strong>Color:</strong> <%= producto.color || '-' %></li>
        <li class="list-group-item"><strong>Forma:</strong> <%= producto.forma || '-' %></li>
        <li class="list-group-item"><strong>Unidad:</strong> <%= producto.unidad || '-' %></li>
        <li class="list-group-item"><strong>Capacidad:</strong> <%= producto.capacidad || '-' %></li>
        <li class="list-group-item"><strong>Precio venta sugerido:</strong> Q <%= producto.precio_venta_sugerido || '0.00' %></li>
      </ul>
    </div>
  </div>

  <!-- Existencias por bodega -->
  <h4>Existencias por bodega</h4>
  <div class="table-responsive mb-4">
    <table class="table table-sm table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>Bodega</th>
          <th class="text-end">Stock disponible</th>
        </tr>
      </thead>
      <tbody>
        <% stocks.forEach(i => { %>
          <tr>
            <td><%= i.bodega %></td>
            <td class="text-end"><%= i.stock %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <!-- Último precio por proveedor -->
  <h4>Último precio por proveedor</h4>
  <div class="table-responsive mb-4">
    <table class="table table-sm table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Proveedor</th>
          <th>Precio compra (Q)</th>
          <th>Precio venta (Q)</th>
          <th>Fecha vigencia</th>
        </tr>
      </thead>
      <tbody>
        <% if (ultimos.length) { %>
          <% ultimos.forEach(u => { %>
            <tr>
              <td><%= u.proveedor %></td>
              <td><%= u.precio_compra %></td>
              <td><%= u.precio_venta || '-' %></td>
              <td><%= new Date(u.fecha_vigencia).toLocaleDateString() %></td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr><td colspan="4" class="text-center text-muted">Sin precios registrados</td></tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <!-- Histórico de precios por proveedor -->
  <h4>Histórico de precios</h4>
  <div class="table-responsive mb-4">
    <table class="table table-sm table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>Proveedor</th>
          <th>Precio compra (Q)</th>
          <th>Precio venta (Q)</th>
          <th>Fecha vigencia</th>
        </tr>
      </thead>
      <tbody>
        <% if (historial.length) { %>
          <% historial.forEach(h => { %>
            <tr>
              <td><%= h.proveedor %></td>
              <td><%= h.precio_compra %></td>
              <td><%= h.precio_venta || '-' %></td>
              <td><%= new Date(h.fecha_vigencia).toLocaleDateString() %></td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr><td colspan="4" class="text-center text-muted">Sin histórico disponible</td></tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <div class="mt-3">
    <a href="/inventario/productos" class="btn btn-outline-secondary">Volver al listado</a>
    <a href="/inventario/productos/<%= producto.id %>/inventario/nuevo" class="btn btn-success">+ Nuevo precio</a>
  </div>
</div>

<%- include('../partials/footer') %>
