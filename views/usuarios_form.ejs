<%- include('partials/header', {
     title: data ? 'Editar usuario' : 'Nuevo usuario',
     user: user
}); %>

<h2 class="mb-4"><%= data ? '✏️ Editar usuario' : '➕ Nuevo usuario' %></h2>

<form class="row g-3" method="POST" enctype="multipart/form-data">
  <div class="col-md-6">
    <label class="form-label">Nombre</label>
    <input class="form-control" name="nombre" required value="<%= data?.nombre || '' %>">
  </div>

  <div class="col-md-6">
    <label class="form-label">Apellido</label>
    <input class="form-control" name="apellido" required value="<%= data?.apellido || '' %>">
  </div>

  <div class="col-md-6">
    <label class="form-label">Usuario</label>
    <input class="form-control" name="usuario" required value="<%= data?.usuario || '' %>">
  </div>

  <div class="col-md-6">
    <label class="form-label">Contraseña
      <small class="text-muted">(dejar vacío si no deseas cambiarla)</small>
    </label>
    <input type="password" class="form-control" name="password">
  </div>

  <div class="col-md-6">
    <label class="form-label">DPI</label>
    <input class="form-control" name="dpi" maxlength="13" value="<%= data?.dpi || '' %>">
  </div>

  <div class="col-md-6">
    <label class="form-label">Correo</label>
    <input type="email" class="form-control" name="correo" value="<%= data?.correo || '' %>">
  </div>

  <div class="col-md-6">
    <label class="form-label">Teléfono</label>
    <input class="form-control" name="telefono" value="<%= data?.telefono || '' %>">
  </div>

  <div class="col-md-6">
    <label class="form-label">Foto de perfil (opcional)</label>
    <input type="file" class="form-control" name="foto" accept="image/*">
  </div>

  <div class="col-md-6">
    <label class="form-label">Rol</label>
    <select class="form-select" name="rol_id" required>
      <% roles.forEach(r => { %>
        <option value="<%= r.id %>" <%= data && data.rol_id == r.id ? 'selected' : '' %>>
          <%= r.nombre %>
        </option>
      <% }) %>
    </select>
  </div>

  <div class="col-md-6">
    <label class="form-label">Estado</label>
    <select class="form-select" name="estado_id" required>
      <% estados.forEach(e => { %>
        <option value="<%= e.id %>" <%= data && data.estado_id == e.id ? 'selected' : '' %>>
          <%= e.nombre %>
        </option>
      <% }) %>
    </select>
  </div>

  <div class="col-12">
    <button class="btn btn-primary">
      <%= data ? 'Actualizar' : 'Crear' %>
    </button>
    <a href="/usuarios" class="btn btn-secondary ms-2">Cancelar</a>
  </div>
</form>

<%- include('partials/footer'); %>
